<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Windows 10环境下V8引擎的编译方法 | HermitSun</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="觉今是而昨非">
    <link rel="preload" href="/assets/css/0.styles.8fbd8908.css" as="style"><link rel="preload" href="/assets/js/app.af0de8d1.js" as="script"><link rel="preload" href="/assets/js/2.266c3758.js" as="script"><link rel="preload" href="/assets/js/12.9fa159a8.js" as="script"><link rel="prefetch" href="/assets/js/10.a03b031e.js"><link rel="prefetch" href="/assets/js/11.09602ac2.js"><link rel="prefetch" href="/assets/js/13.2f257f4f.js"><link rel="prefetch" href="/assets/js/14.936cbee5.js"><link rel="prefetch" href="/assets/js/15.369534b9.js"><link rel="prefetch" href="/assets/js/16.4d11de0f.js"><link rel="prefetch" href="/assets/js/17.e16d2dc1.js"><link rel="prefetch" href="/assets/js/18.277886e1.js"><link rel="prefetch" href="/assets/js/19.449788e5.js"><link rel="prefetch" href="/assets/js/20.0420db13.js"><link rel="prefetch" href="/assets/js/21.607f9545.js"><link rel="prefetch" href="/assets/js/22.5b63ffdb.js"><link rel="prefetch" href="/assets/js/23.e0ac74b8.js"><link rel="prefetch" href="/assets/js/24.49820aba.js"><link rel="prefetch" href="/assets/js/3.0601f710.js"><link rel="prefetch" href="/assets/js/4.2b7fc900.js"><link rel="prefetch" href="/assets/js/5.4c2d18ff.js"><link rel="prefetch" href="/assets/js/6.36d80060.js"><link rel="prefetch" href="/assets/js/7.9434fcd3.js"><link rel="prefetch" href="/assets/js/8.dcc8b782.js"><link rel="prefetch" href="/assets/js/9.a5403591.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8fbd8908.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HermitSun</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blogs/" class="nav-link router-link-active">
  Blogs
</a></div><div class="nav-item"><a href="/notes/" class="nav-link">
  Notes
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Contact" class="dropdown-title"><span class="title">Contact</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/HermitSun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/HermitSun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/yunwuxin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  语雀
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blogs/" class="nav-link router-link-active">
  Blogs
</a></div><div class="nav-item"><a href="/notes/" class="nav-link">
  Notes
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Contact" class="dropdown-title"><span class="title">Contact</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/HermitSun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/HermitSun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/yunwuxin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  语雀
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/blogs/2020-04/" class="sidebar-heading clickable"><span>2020-04</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blogs/2020-05/" class="sidebar-heading clickable router-link-active open"><span>2020-05</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/2020-05/ESLint + TypeScript配置全局变量.html" class="sidebar-link">ESLint + TypeScript配置全局变量</a></li><li><a href="/blogs/2020-05/pow函数有四样写法，你知道吗.html" class="sidebar-link">pow函数有四样写法，你知道吗</a></li><li><a href="/blogs/2020-05/Ubuntu 18.04升级systemctl（systemd）到v245.html" class="sidebar-link">Ubuntu 18.04升级systemctl（systemd）到v245</a></li><li><a href="/blogs/2020-05/Windows 10环境下V8引擎的编译方法.html" class="active sidebar-link">Windows 10环境下V8引擎的编译方法</a></li><li><a href="/blogs/2020-05/前端可能用到的工具的代理设置方法.html" class="sidebar-link">前端可能用到的工具的代理设置方法</a></li><li><a href="/blogs/2020-05/在nuxt中使用keep-alive的两种可能方案.html" class="sidebar-link">在nuxt中使用keep-alive的两种可能方案</a></li><li><a href="/blogs/2020-05/在Vue项目中导入外部字体的注意点.html" class="sidebar-link">在Vue项目中导入外部字体的注意点</a></li><li><a href="/blogs/2020-05/精读ECMAScript规范：完成记录.html" class="sidebar-link">精读ECMAScript规范：完成记录（Completion Record）</a></li><li><a href="/blogs/2020-05/精读ECMAScript规范：截断.html" class="sidebar-link">精读ECMAScript规范：截断</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blogs/2020-06/" class="sidebar-heading clickable"><span>2020-06</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/需求与商业模式创新/" class="sidebar-heading clickable"><span>需求与商业模式创新</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="windows-10环境下v8引擎的编译方法"><a href="#windows-10环境下v8引擎的编译方法" class="header-anchor">#</a> Windows 10环境下V8引擎的编译方法</h1> <p>先说说为什么我要干这个事吧。看起来内核跟我们日常开发没什么关系，但是在做性能优化的时候，性能分析可能会需要深入到汇编指令的层面；可以利用d8做到这一点。比如：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./out/x64.debug/d8  --print-opt-code test.js
</code></pre></div><p>再扯下去就扯远了，这次主要是记录一下编译方法。</p> <hr> <p>先说明一下环境，我用的是Windows 10，然后电脑上已经有了之前学C++的时候装的VS 2017 Community，也有一个anaconda的Python 3.7，以及很基础的Git。其中VS还是很重要的，在Windows下编译基于C++的一些东西还是挺有用的；Python 3.7是不行的，需要倒回去装一个Python 2.7（然而今年年初的时候已经停止维护了，sigh），下面会说到。</p> <p>首先的首先，建议设置一个代理，这样能快一点。设置方法可以参考<a href="https://blog.csdn.net/HermitSun/article/details/106069175" target="_blank" rel="noopener noreferrer">之前的一篇文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，不过代理需要自己提供。</p> <p>首先按照<a href="https://chromium.googlesource.com/chromium/tools/depot_tools" target="_blank" rel="noopener noreferrer">官方的说法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，把仓库clone下来：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> clone https://chromium.googlesource.com/chromium/tools/depot_tools
</code></pre></div><p>然后把clone下来的仓库的路径加入环境变量。比如我clone到了C盘根目录，那就往环境变量里加一个<code>C:\depot_tools</code>。为什么要这么做，因为接下来需要执行一些命令，用环境变量比较方便。或者你愿意的话，也可以直接到clone下来的仓库里去执行。</p> <p>然后在命令行设置一个环境变量（因为我已经有VS了，没有的话建议去下一个）。有人说在环境变量里设置，我觉得没必要，反正就用一次，到时候还得清理，多麻烦。直接在命令行弄一个就好了：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">set</span> DEPOT_TOOLS_WIN_TOOLCHAIN = 0
</code></pre></div><p>因为我电脑没分区，只有一个C盘，所以VS默认是在C盘的。看到网上有人说如果VS不是装在C盘的，可能需要一些额外的设置。在这里放一下，我没有验证，仅供参考：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">set</span> GYP_MSVS_OVERRIDE_PATH = &lt;path&gt;
<span class="token function">set</span> GYP_MSVS_VERSION = 2017
</code></pre></div><p>然后执行这两个命令（没有代理可能会卡住）：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>fetch v8
gclient <span class="token function">sync</span>
</code></pre></div><p>在这里可能会很久。fetch是把代码拉下来，sync是下载需要的环境。如果之前没设置<code>DEPOT_TOOLS_WIN_TOOLCHAIN</code>，在这里会报错。</p> <p>同时，它可能还会有这样一个报错：</p> <div class="language- extra-class"><pre class="language-text"><code>You must install the &quot;Debugging Tools for Windows&quot; feature from the Windows 10 SDK.
</code></pre></div><p>按理来说，Windows SDK是跟VS一起安装的，并没有给我配置的机会。那这个问题怎么解决呢？还是有办法的。打开“卸载或更改程序”，在里面找到“Windows Software Development Kit”，然后点击“修改”，然后选择“Change”，在里面把“Debugging Tools for Windows”打上勾，然后点击“change”，就好了。如果觉得有点抽象，可以参考Stack Overflow上的<a href="https://stackoverflow.com/a/59031498" target="_blank" rel="noopener noreferrer">这个回答<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，里面有图。</p> <p>然后就是激动人心的编译了：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>cd v8
python tools<span class="token operator">/</span>dev<span class="token operator">/</span>v8gen<span class="token punctuation">.</span>py x64<span class="token punctuation">.</span>debug
ninja <span class="token operator">-</span>C out<span class="token punctuation">.</span>gn<span class="token operator">/</span>x64<span class="token punctuation">.</span>debug d8
</code></pre></div><p>在这个过程中，如果用的是Python 3，就会报错……原因很简单，他依赖于Python 2的一些库，比如urllib2。所以要是没装2.7，赶紧装一个吧……</p> <p>然后就是CPU 100%的编译过程，大概会持续半小时到一小时。</p> <p>然后？然后没然后了。编译好的d8在out目录下，就可以开始用了。文章开头就写了一个简单的调用方法。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新于:</span> <span class="time">5/25/2020, 4:55:11 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blogs/2020-05/Ubuntu 18.04升级systemctl（systemd）到v245.html" class="prev">
        Ubuntu 18.04升级systemctl（systemd）到v245
      </a></span> <span class="next"><a href="/blogs/2020-05/前端可能用到的工具的代理设置方法.html">
        前端可能用到的工具的代理设置方法
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.af0de8d1.js" defer></script><script src="/assets/js/2.266c3758.js" defer></script><script src="/assets/js/12.9fa159a8.js" defer></script>
  </body>
</html>
