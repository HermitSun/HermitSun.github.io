(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{388:function(e,t,s){"use strict";s.r(t);var n=s(43),a=Object(n.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"ubuntu-18-04升级systemctl（systemd）到v245"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-18-04升级systemctl（systemd）到v245"}},[e._v("#")]),e._v(" Ubuntu 18.04升级systemctl（systemd）到v245")]),e._v(" "),s("p",[e._v("我们知道systemctl是基于systemd的，因为我装机的时候是16.04，所以systemctl的版本才223，最近需要搞一个东西，对systemd的版本有要求，就升级了一下。其间踩了很多坑，就稍微记录一下。")]),e._v(" "),s("p",[e._v("先到systemd的仓库里去下个源码：https://github.com/systemd/systemd/releases，我选了v245，要升级就索性升到最新版，然后tar + configure一条龙，然后……然后就报错了，提示"),s("code",[e._v("exec: meson: not found")]),e._v("。")]),e._v(" "),s("p",[e._v("查了一下，meson是个python写的构建工具。那还不简单，apt-get装一个就是了，"),s("code",[e._v("apt-get install meson")]),e._v("一气呵成，然后再次configure……又报错了。这次是什么？"),s("code",[e._v("Meson version is 0.45.1 but project requires >= 0.46")]),e._v(".得，又是apt-get的问题。我们知道，apt-get为了稳定，经常会给我们装一些远古版本的东西。我至今还记得当年apt-get给我装了一个node 4。")]),e._v(" "),s("p",[e._v("那要怎么安装新版本的meson呢，手动下载编译吗？可以，但没必要。不要忘了meson是py写的，我们可以用pip来安装（前提是有py的环境，怎么装py不是这里的重点）："),s("code",[e._v("pip install meson")]),e._v("。这里的pip是"),s("strong",[e._v("py3")]),e._v("的pip，有可能你那叫pip3。")]),e._v(" "),s("p",[e._v("然后再次configure，又报错了，这次是"),s("code",[e._v("Program(s) ['gperf'] not found or not executable")]),e._v("。这个也简单，装个gperf就是了，"),s("code",[e._v("apt-get install gperf")]),e._v("。这次的依赖好像可以用apt-get。")]),e._v(" "),s("p",[e._v("然后再次configure，又双报错了，这次是"),s("code",[e._v("/usr/sbin/update-info-dir: 4: /etc/environment: Syntax error: Unterminated quoted string")]),e._v("。想来想去也不知道是为啥，查了半天也没查到，干脆去看看/etc/environment的内容：")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("LANG")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"zh_CN.UTF-8"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("LANGUAGE")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v('"zh_CN:zh:en_US:en\n')])])]),s("p",[e._v("？最后那个引号去哪了？")]),e._v(" "),s("p",[e._v("把最后的引号补上，再次configure，又双叒报错了，这次是"),s("code",[e._v("Problem encountered: POSIX caps headers not found")]),e._v("。查了一下，发现是少了sys/capability.h。")]),e._v(" "),s("p",[e._v("因为我这是Ubuntu，就"),s("code",[e._v("apt-get install libcap-dev")]),e._v("装了个libcap-dev（centos应该是libcap-devel），然后再次configure，又双叒叕报错了，这次是"),s("code",[e._v('ERROR: Dependency "mount" not found, tried pkgconfig')]),e._v("。")]),e._v(" "),s("p",[e._v("那就装一个，"),s("code",[e._v("apt-get install libmount-dev")]),e._v("，然后再次configure，这次终于好了。"),s("code",[e._v("make && make install")]),e._v("，然后"),s("code",[e._v("systemctl --version")]),e._v("验证一下：")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("systemd "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("245")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("245")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n-PAM -AUDIT -SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP -LIBCRYPTSETUP -GCRYPT -GNUTLS -ACL -XZ -LZ4 -SECCOMP +BLKID -ELFUTILS -KMOD -IDN2 -IDN -PCRE2 default-hierarchy"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("unified\n")])])]),s("p",[e._v("搞定。")])])}),[],!1,null,null,null);t.default=a.exports}}]);